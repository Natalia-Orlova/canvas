<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!--для отображения изображения с камеры-->
    <!-- <video id="video" autoplay></video>
    <canvas id="qrcode"></canvas> -->
    <div id="reader" width="600px"></div>
    <div class="result"></div>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</body>
<script>
    // const video = document.getElementById('video');
    // const canvas = document.getElementById('qrcode');
    // const context = canvas.getContext('2d');
    // const jpegDataURL = canvas.toDataURL('image/jpeg'); // преобразовать в jpeg

    // const img = new Image();
    // img.onload = drawImageActualSize;
    // img.src = 'img3.jpg';

    // function drawImageActualSize() {
    //     canvas.width = this.naturalWidth;
    //     canvas.height = this.naturalHeight;
    //     context.drawImage(this, 0, 0);
    //     // context.drawImage(this, 0, 0, this.width, this.height);
    // }


    // const constrains = {
    //     video: {
    //         facingMode: { exact: "environment" },
    //         // width: { min: 1280 },
    //         // height: { min: 720 },
    //     }
    // }
    // navigator.mediaDevices.getUserMedia(constrains)
    //     .then(stream => {
    //         video.srcObject = stream;
    //         video.play();

    //         // Draw the video frame onto the canvas every 2000ms
    //         setInterval(() => {
    //             context.drawImage(video, 0, 0, canvas.width, canvas.height);
    //         }, 2000);
    //     })
    //     .catch(error => {
    //         console.log('Error accessing camera:', error);
    //     });


    // navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
    //     .then(function (stream) {
    //         // Create a video element and attach the stream to it
    //         var video = document.createElement('video');
    //         video.setAttribute('id', 'video');
    //         video.srcObject = stream;
    //         video.play();

    //         // After the video starts playing, take a snapshot
    //         video.onplayed = function (ev) {
    //             setTimeout(function () {
    //                 // Take a snapshot and convert it to a Blob
    //                 var canvas = document.createElement('canvas');
    //                 canvas.setAttribute('id', 'qrcode');
    //                 canvas.width = video.videoWidth;
    //                 canvas.height = video.videoHeight;
    //                 canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
    //                 var imageBlob = new Blob([canvas.toDataURL('image/jpeg').split(',')[1]], { type: 'image/jpeg' });

    //                 // Send the image to the server
    //                 var xhr = new XMLHttpRequest();
    //                 xhr.open('POST', 'http://your-server.com/upload', true);
    //                 xhr.send(imageBlob);
    //             }, 1000);
    //         };
    //     });

    function onScanSuccess(decodedText, decodedResult) {
        // handle the scanned code as you like, for example:
        console.log(`Code matched = ${decodedText}`, decodedResult);
        const result = document.querySelector('.result');
        result.textContent = `Code matched = ${decodedText}, ${decodedResult}`;
    }

    function onScanFailure(error) {
        // handle scan failure, usually better to ignore and keep scanning.
        // for example:
        console.warn(`Code scan error = ${error}`);
    }

    let html5QrcodeScanner = new Html5QrcodeScanner(
        "reader",
        { fps: 10, qrbox: { width: 500, height: 500 } },
  /* verbose= */ false);
    html5QrcodeScanner.render(onScanSuccess, onScanFailure);
</script>

</html>